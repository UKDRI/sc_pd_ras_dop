<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-11-26 Tue 16:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Initial Data Exploration and Data Extraction</title>
<meta name="author" content="Sam Neaves" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="overview.html"> UP </a>
 |
 <a accesskey="H" href=""> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Initial Data Exploration and Data Extraction</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga5706ce">1. About</a></li>
<li><a href="#orgf958c29">2. Data info</a>
<ul>
<li><a href="#org807b5c6">2.1. Get the normalised expression values</a></li>
<li><a href="#orga81c410">2.2. Get the count expression values</a></li>
</ul>
</li>
<li><a href="#orgff4fc78">3. Finding the overlap</a></li>
<li><a href="#org0fb76b5">4. Complexes</a></li>
<li><a href="#org57e068a">5. Edge types</a></li>
<li><a href="#orga00a45d">6. Select cells and genes</a></li>
</ul>
</div>
</div>
<div id="navigation"> <div id="mytitle"><h1>ParkinsonPathAI (Working title) - AI Models for Pathway Analysis in Parkinson’s Disease</h1></div>
<ul class="org-ul">
<li><a href="overview.html">Overview</a></li>
<li><a href="get_prior_knowledge_network.html">Get prior knowledge network</a></li>
<li><a href="initial_exploration_and_extraction.html">Initial Data Exploration and Data Extraction</a></li>
<li><a href="cell_state_subgroup_discover.html">Cell State Subgroup Discovery</a></li>
<li><a href="cell_state_subgroup_discover.html">Cell State Subgroup Discovery2</a></li>
</ul>
</div>

<div id="outline-container-orga5706ce" class="outline-2">
<h2 id="orga5706ce"><span class="section-number-2">1.</span> About</h2>
<div class="outline-text-2" id="text-1">
<p>
This work is a part of the <a href="../readme.html">ParkinsonPathAI</a> project. The code described
here is part 2 of the work.
</p>
</div>
</div>


<div id="outline-container-orgf958c29" class="outline-2">
<h2 id="orgf958c29"><span class="section-number-2">2.</span> Data info</h2>
<div class="outline-text-2" id="text-2">
<p>
"Just sending the single nuclei data for the dopaminergic neurons in our atlas as Caleb suggested.
The file “SNatlas_DaNs_seurat.RData” is in the usual Dropbox folder.
The Seurat object in it is called “sn_atlas_dans” and contains all
neurons across all disease stages and subtypes. You can access disease
by sn_atlas_dans$Disease and cell subtype by
sn_atlas_dans$CellSubType. And extract gene expression data as raw
counts genes_counts&lt;-as.matrix(GetAssayData(sn_atlas_dans, slot =
"counts")) or normalised
genes_norm&lt;-as.matrix(GetAssayData(sn_atlas_dans, slot = "data"))."
</p>



<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(dplyr)
<span style="color: #008b8b;">library</span>(Seurat)
<span style="color: #008b8b;">library</span>(patchwork)

data_location <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"/Users/samneaves/Documents/test_data/forSam/SNatlas_DaNs_seurat.RData"</span>
<span style="color: #008b8b;">load</span>(data_location)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">head(sn_atlas_dans$CellSubType)
</pre>
</div>
</div>

<div id="outline-container-org807b5c6" class="outline-3">
<h3 id="org807b5c6"><span class="section-number-3">2.1.</span> Get the normalised expression values</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-R">genes_norm<span style="color: #008b8b;">&lt;-</span>as.matrix(GetAssayData(sn_atlas_dans, slot = <span style="color: #8b2252;">"data"</span>))
</pre>
</div>
</div>
</div>


<div id="outline-container-orga81c410" class="outline-3">
<h3 id="orga81c410"><span class="section-number-3">2.2.</span> Get the count expression values</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-R">genes_counts<span style="color: #008b8b;">&lt;-</span>as.matrix(GetAssayData(sn_atlas_dans, slot = <span style="color: #8b2252;">"counts"</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff4fc78" class="outline-2">
<h2 id="orgff4fc78"><span class="section-number-2">3.</span> Finding the overlap</h2>
<div class="outline-text-2" id="text-3">
<p>
Find the overlap of list of genes that we get back from pathway commons and our data
</p>
<div class="org-src-container">
<pre class="src src-R">network_data <span style="color: #008b8b;">&lt;-</span> read.table(<span style="color: #8b2252;">"./data/pybravo_output/expanded_reg_md10-unified.sif"</span>, quote = <span style="color: #8b2252;">""</span>, header = <span style="color: #228b22;">FALSE</span>, stringsAsFactors = <span style="color: #228b22;">FALSE</span>, sep = <span style="color: #8b2252;">"\t"</span>)
head(network_data)
nodes <span style="color: #008b8b;">&lt;-</span> unique(c(network_data$V1, network_data$V3))
</pre>
</div>

<pre class="example">
        V1         V2     V3
1 Fra1/JUN ACTIVATION   CCL2
2 Fra1/JUN ACTIVATION   Fra1
3 Fra1/JUN ACTIVATION    IL6
4 Fra1/JUN ACTIVATION p14ARF
5 Fra1/JUN ACTIVATION   MMP9
6 Fra1/JUN ACTIVATION  CXCL8
</pre>


<div class="org-src-container">
<pre class="src src-R">length(nodes)
</pre>
</div>

<pre class="example">
[1] 1053
</pre>


<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Convert the rownames of genes_counts into a vector</span>
genes_names <span style="color: #008b8b;">&lt;-</span> rownames(genes_counts)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Get the intersection between the 'name' column in node_table and the rownames of genes_counts_subset_df</span>
common_names <span style="color: #008b8b;">&lt;-</span> intersect(nodes, genes_names)

<span style="color: #b22222;"># </span><span style="color: #b22222;">View the result</span>
length(common_names)
</pre>
</div>

<pre class="example">
526
</pre>
</div>
</div>

<div id="outline-container-org0fb76b5" class="outline-2">
<h2 id="org0fb76b5"><span class="section-number-2">4.</span> Complexes</h2>
<div class="outline-text-2" id="text-4">
<p>
In the graph representation we have genes and protein complexes.
A protein complex node is represented by Item/Item. For example
</p>

<p>
SMAD3/SMAD4/JUN/FOS
</p>

<p>
When we match our gene expression data to the network. These nodes
will be unobserved. We will need to infer if they are able to
form/activate.
</p>

<p>
In the way that the pybravo paper describes these nodes are used in
there iggy analysis. The 'part_of' edge is treated as plus. But I think the standard consistency
check is only looking for at least one positive edge to label a node
as consistant So not sure if that is appropiate. (will add detail to
this point later).
</p>

<p>
For the time being the number of complexes seem to be :
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Identify rows in the 'name' column that contain '/'</span>
complexes <span style="color: #008b8b;">&lt;-</span> grep(<span style="color: #8b2252;">"/"</span>, nodes)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Count the number of complexes</span>
num_complexes <span style="color: #008b8b;">&lt;-</span> length(complexes)

<span style="color: #b22222;"># </span><span style="color: #b22222;">View the count</span>
num_complexes
</pre>
</div>

<pre class="example">
296
</pre>
</div>
</div>

<div id="outline-container-org57e068a" class="outline-2">
<h2 id="org57e068a"><span class="section-number-2">5.</span> Edge types</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Count occurrences of each edge type in the second column (V2)</span>
edge_counts <span style="color: #008b8b;">&lt;-</span> table(network_data$V2)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Display the counts of each edge type</span>
print(edge_counts)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">ACTIVATION</td>
<td class="org-right">1710</td>
</tr>

<tr>
<td class="org-left">INHIBITION</td>
<td class="org-right">655</td>
</tr>

<tr>
<td class="org-left">PART_OF</td>
<td class="org-right">567</td>
</tr>

<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">95</td>
</tr>
</tbody>
</table>



<div class="org-src-container">
<pre class="src src-R">str(sn_atlas_dans)
summary(sn_atlas_dans)
</pre>
</div>
</div>
</div>
<div id="outline-container-orga00a45d" class="outline-2">
<h2 id="orga00a45d"><span class="section-number-2">6.</span> Select cells and genes</h2>
<div class="outline-text-2" id="text-6">
<p>
We want to select Cells that are either control or parkinsons
We want to only select the genes that are in our network.
</p>
<div class="org-src-container">
<pre class="src src-R">sn_atlas_dans_ctrl_vs_pd <span style="color: #008b8b;">&lt;-</span> subset(sn_atlas_dans, subset = Disease <span style="color: #008b8b;">%in%</span> c(<span style="color: #8b2252;">"CTR"</span>, <span style="color: #8b2252;">"PD_B5-6"</span>, <span style="color: #8b2252;">"PD_B3-4"</span>))
sn_atlas_dans_ctrl_vs_pd_pathway <span style="color: #008b8b;">&lt;-</span> sn_atlas_dans_ctrl_vs_pd[common_names,]
dim(sn_atlas_dans_ctrl_vs_pd_pathway)


</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">526</td>
</tr>

<tr>
<td class="org-right">6385</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-R">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Extract the expression matrix for the subset</span>
expression_matrix <span style="color: #008b8b;">&lt;-</span> as.data.frame(t(as.matrix(sn_atlas_dans_ctrl_vs_pd_pathway@assays$RNA@data)))

<span style="color: #b22222;"># </span><span style="color: #b22222;">Add Disease column from metadata</span>
expression_matrix$Disease <span style="color: #008b8b;">&lt;-</span> sn_atlas_dans_ctrl_vs_pd_pathway@meta.data$Disease

<span style="color: #b22222;"># </span><span style="color: #b22222;">Save to CSV</span>
write.csv(expression_matrix, file = <span style="color: #8b2252;">"./data/cell_expression_with_disease.csv"</span>, row.names = <span style="color: #228b22;">TRUE</span>)


</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Extract the count matrix for the subset and transpose it for cells as rows</span>
count_matrix <span style="color: #008b8b;">&lt;-</span> as.data.frame(t(as.matrix(sn_atlas_dans_ctrl_vs_pd_pathway@assays$RNA@counts)))

<span style="color: #b22222;"># </span><span style="color: #b22222;">Add Disease column from metadata</span>
count_matrix$Disease <span style="color: #008b8b;">&lt;-</span> sn_atlas_dans_ctrl_vs_pd_pathway@meta.data$Disease

<span style="color: #b22222;"># </span><span style="color: #b22222;">Save to CSV</span>
write.csv(count_matrix, file = <span style="color: #8b2252;">"./data/cell_count_with_disease.csv"</span>, row.names = <span style="color: #228b22;">TRUE</span>)

</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Sam Neaves</p>
<p class="date">Created: 2024-11-26 Tue 16:15</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
